<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Assistant</title>
    <link rel="icon" href="/assets/logo-round.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Theme Variables */
        :root {
            /* Default Theme - Cyber Blue */
            --primary: #00d4ff;
            --primary-dark: #0099cc;
            --secondary: #7c3aed;
            --accent: #ff6b6b;
            --bg-primary: #0a0a0f;
            --bg-secondary: #1a1a2e;
            --bg-glass: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border: rgba(255, 255, 255, 0.2);
            --shadow: rgba(0, 212, 255, 0.3);
            --gradient: linear-gradient(135deg, #00d4ff, #7c3aed);
        }

        /* Neon Purple Theme */
        .theme-neon {
            --primary: #ff00ff;
            --primary-dark: #cc00cc;
            --secondary: #00ffff;
            --accent: #ffff00;
            --bg-primary: #0f0a0f;
            --bg-secondary: #2e1a2e;
            --bg-glass: rgba(255, 0, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #d0b0d0;
            --border: rgba(255, 0, 255, 0.3);
            --shadow: rgba(255, 0, 255, 0.4);
            --gradient: linear-gradient(135deg, #ff00ff, #00ffff);
        }

        /* Ocean Theme */
        .theme-ocean {
            --primary: #00bcd4;
            --primary-dark: #0097a7;
            --secondary: #4fc3f7;
            --accent: #26c6da;
            --bg-primary: #0a1a2e;
            --bg-secondary: #1a2f4e;
            --bg-glass: rgba(0, 188, 212, 0.1);
            --text-primary: #e0f7fa;
            --text-secondary: #b0e0e6;
            --border: rgba(0, 188, 212, 0.3);
            --shadow: rgba(0, 188, 212, 0.3);
            --gradient: linear-gradient(135deg, #00bcd4, #4fc3f7);
        }

        /* Sunset Theme */
        .theme-sunset {
            --primary: #ff6b35;
            --primary-dark: #e55a2b;
            --secondary: #ffa726;
            --accent: #ff7043;
            --bg-primary: #1a0f0a;
            --bg-secondary: #2e1f1a;
            --bg-glass: rgba(255, 107, 53, 0.1);
            --text-primary: #fff3e0;
            --text-secondary: #ffcc80;
            --border: rgba(255, 107, 53, 0.3);
            --shadow: rgba(255, 107, 53, 0.3);
            --gradient: linear-gradient(135deg, #ff6b35, #ffa726);
        }

        /* Matrix Theme */
        .theme-matrix {
            --primary: #00ff41;
            --primary-dark: #00cc33;
            --secondary: #39ff14;
            --accent: #00ff00;
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-glass: rgba(0, 255, 65, 0.1);
            --text-primary: #00ff41;
            --text-secondary: #008f11;
            --border: rgba(0, 255, 65, 0.3);
            --shadow: rgba(0, 255, 65, 0.4);
            --gradient: linear-gradient(135deg, #00ff41, #39ff14);
        }

        /* Light Theme */
        .theme-light {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --accent: #06b6d4;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-glass: rgba(0, 0, 0, 0.05);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: rgba(0, 0, 0, 0.1);
            --shadow: rgba(37, 99, 235, 0.2);
            --gradient: linear-gradient(135deg, #2563eb, #7c3aed);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 50%, var(--primary) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, var(--secondary) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, var(--accent) 0%, transparent 50%);
            animation: bgShift 20s ease-in-out infinite;
        }

        @keyframes bgShift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        /* Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            opacity: 0.6;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0; }
            50% { transform: translateY(-100px) rotate(180deg); opacity: 1; }
        }

        /* Glassomorphism Base */
        .glass {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px var(--shadow);
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            height: 4rem;
            position: relative;
            z-index: 10;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo {
            width: 2.5rem;
            height: 2.5rem;
            background: var(--gradient);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.125rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .app-title {
            font-size: 1.25rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--shadow);
        }

        /* Theme Selector */
        .theme-selector {
            position: relative;
        }

        .theme-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 0.5rem;
            display: none;
            flex-direction: column;
            gap: 0.25rem;
            min-width: 150px;
            z-index: 100;
        }

        .theme-dropdown.active {
            display: flex;
        }

        .theme-option {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .theme-option:hover {
            background: var(--primary);
            color: white;
        }

        /* Main Container */
        .app-container {
            display: flex;
            height: calc(100vh - 4rem);
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 16rem;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 5;
        }

        .new-chat-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .new-chat-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .new-chat-btn:hover::before {
            left: 100%;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .history-section {
            flex: 1;
            overflow: hidden;
        }

        .history-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            padding: 0 0.5rem;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            max-height: 100%;
            overflow-y: auto;
        }

        .history-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid transparent;
        }

        .history-item:hover {
            background: var(--primary);
            color: white;
            transform: translateX(4px);
            border-color: var(--primary);
        }

        .history-item.active {
            background: var(--gradient);
            color: white;
            border-color: var(--primary);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Welcome Message */
        .welcome-container {
            max-width: 50rem;
            margin: 0 auto;
            text-align: center;
            padding: 2rem;
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 10px var(--primary)); }
            to { filter: drop-shadow(0 0 20px var(--primary)); }
        }

        .welcome-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 40rem;
            margin-left: auto;
            margin-right: auto;
        }

        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            max-width: 60rem;
            margin: 0 auto;
        }

        .capability-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .capability-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .capability-card:hover::before {
            opacity: 0.1;
        }

        .capability-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px var(--shadow);
            border-color: var(--primary);
        }

        .capability-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .capability-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 1.125rem;
        }

        .capability-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Messages */
        .message {
            display: flex;
            gap: 1rem;
            max-width: 50rem;
            margin: 0 auto;
            width: 100%;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            position: relative;
        }

        .user .avatar {
            background: var(--gradient);
            color: white;
        }

        .ai .avatar {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            color: var(--primary);
        }

        .message-content {
            flex: 1;
        }

        .username {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .message-text {
            line-height: 1.6;
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            white-space: pre-wrap;
            position: relative;
        }

        .user .message-text {
            background: var(--gradient);
            color: white;
            border-color: var(--primary);
        }

        .message-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .action-icon {
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .action-icon:hover {
            color: var(--primary);
            background: var(--bg-glass);
        }

        /* Input Container */
        .input-container {
            padding: 1rem 1.5rem;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
        }

        .input-box {
            max-width: 50rem;
            margin: 0 auto;
            position: relative;
        }

        .text-input {
            width: 100%;
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            padding: 1rem 1.25rem;
            padding-right: 8rem;
            font-size: 1rem;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            color: var(--text-primary);
            resize: none;
            min-height: 3.5rem;
            max-height: 12rem;
            transition: all 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary), 0.1);
        }

        .text-input::placeholder {
            color: var(--text-secondary);
        }

        .input-actions {
            position: absolute;
            right: 1rem;
            bottom: 1rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .input-btn {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .input-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .send-btn {
            background: var(--gradient);
            color: white;
            border: none;
        }

        .send-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                left: -16rem;
                z-index: 100;
                height: 100%;
                background: var(--bg-secondary);
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .capabilities-grid {
                grid-template-columns: 1fr;
            }
            
            .welcome-title {
                font-size: 2rem;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="theme-cyber">
    <!-- Animated Background -->
    <div class="bg-animation"></div>
    
    <!-- Particles -->
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <header class="app-header glass">
        <div class="logo-container">
            <button class="action-btn md:hidden" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">H</div>
            <div class="app-title">Healthcare Assistant</div>
        </div>
        <div class="header-actions">
            <div class="theme-selector">
                <button class="action-btn" id="theme-toggle">
                    <i class="fas fa-palette"></i>
                </button>
                <div class="theme-dropdown" id="theme-dropdown">
                    <div class="theme-option" data-theme="theme-cyber">Cyber Blue</div>
                    <div class="theme-option" data-theme="theme-neon">Neon Purple</div>
                    <div class="theme-option" data-theme="theme-ocean">Ocean</div>
                    <div class="theme-option" data-theme="theme-sunset">Sunset</div>
                    <div class="theme-option" data-theme="theme-matrix">Matrix</div>
                    <div class="theme-option" data-theme="theme-light">Light</div>
                </div>
            </div>
            <button class="action-btn">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar glass" id="sidebar">
            <button class="new-chat-btn" id="new-chat-btn">
                <i class="fas fa-plus"></i>
                <span>New Chat</span>
            </button>
            
            <div class="history-section">
                <div class="history-title">Recent Conversations</div>
                <div class="history-list" id="history-list">
                    <div class="history-item active">
                        <i class="fas fa-comment"></i>
                        <span>Skin lesion analysis</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-comment"></i>
                        <span>Chest X-ray review</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-comment"></i>
                        <span>Medication question</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-comment"></i>
                        <span>Brain tumor detection</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-comment"></i>
                        <span>Diabetes management</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Messages Container -->
            <div class="chat-messages" id="chat-messages">
                <!-- Welcome message -->
                <div class="welcome-container" id="welcome-message">
                    <h1 class="welcome-title">Multi-Modal Healthcare Assistant</h1>
                    <p class="welcome-subtitle">Upload medical images, ask questions, and get AI-powered insights for diagnosis and treatment with cutting-edge technology.</p>
                    
                    <div class="capabilities-grid">
                        <div class="capability-card" data-prompt="Analyze this skin lesion image">
                            <div class="capability-icon">
                                <i class="fas fa-allergies"></i>
                            </div>
                            <div class="capability-title">Skin Lesion Analysis</div>
                            <div class="capability-desc">Upload images for melanoma detection</div>
                        </div>
                        
                        <div class="capability-card" data-prompt="Review this chest X-ray">
                            <div class="capability-icon">
                                <i class="fas fa-lungs"></i>
                            </div>
                            <div class="capability-title">Chest X-ray Review</div>
                            <div class="capability-desc">Identify pneumonia, COVID-19, and other conditions</div>
                        </div>
                        
                        <div class="capability-card" data-prompt="Explain this medication">
                            <div class="capability-icon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="capability-title">Medication Assistant</div>
                            <div class="capability-desc">Information on drugs, interactions, and side effects</div>
                        </div>
                        
                        <div class="capability-card" data-prompt="Analyze this MRI scan">
                            <div class="capability-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="capability-title">Brain Imaging</div>
                            <div class="capability-desc">Detect tumors, hemorrhages, and other abnormalities</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Container -->
            <div class="input-container">
                <div class="input-box">
                    <textarea 
                        class="text-input" 
                        id="message-input" 
                        placeholder="Ask a medical question or describe an image..." 
                        rows="1"
                    ></textarea>
                    <div class="input-actions">
                        <button class="input-btn" id="file-btn" title="Upload image">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="input-btn" id="voice-btn" title="Voice input">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="input-btn send-btn" id="send-btn" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Particle System
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // DOM Elements
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');
        const themeToggle = document.getElementById('theme-toggle');
        const themeDropdown = document.getElementById('theme-dropdown');
        const newChatBtn = document.getElementById('new-chat-btn');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const fileBtn = document.getElementById('file-btn');
        const voiceBtn = document.getElementById('voice-btn');
        const chatMessages = document.getElementById('chat-messages');
        const welcomeMessage = document.getElementById('welcome-message');
        const historyList = document.getElementById('history-list');
        const capabilityCards = document.querySelectorAll('.capability-card');
        const themeOptions = document.querySelectorAll('.theme-option');

        // State
        let currentTheme = localStorage.getItem('theme') || 'theme-cyber';
        let currentChat = [];
        let isRecording = false;
        
        // Initialize
        function init() {
            // Set theme
            document.body.className = currentTheme;
            
            // Create particles
            createParticles();
            
            // Set up event listeners
            setupEventListeners();
            
            // Load chat history
            loadChatHistory();
        }
        
        // Event Listeners
        function setupEventListeners() {
            // Mobile menu
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('active');
                });
            }
            
            // Theme toggle
            themeToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                themeDropdown.classList.toggle('active');
            });

            // Close theme dropdown when clicking outside
            document.addEventListener('click', () => {
                themeDropdown.classList.remove('active');
            });

            // Theme options
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.getAttribute('data-theme');
                    setTheme(theme);
                    themeDropdown.classList.remove('active');
                });
            });
            
            // New chat
            newChatBtn.addEventListener('click', startNewChat);
            
            // Message input
            messageInput.addEventListener('input', handleInputChange);
            messageInput.addEventListener('keydown', handleKeyDown);
            
            // Send message
            sendBtn.addEventListener('click', sendMessage);
            
            // File upload
            fileBtn.addEventListener('click', () => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/png, image/jpeg, image/jpg';
                fileInput.onchange = handleImageUpload;
                fileInput.click();
            });
            
            // Voice input
            voiceBtn.addEventListener('click', toggleVoiceInput);
            
            // Capability cards
            capabilityCards.forEach(card => {
                card.addEventListener('click', () => {
                    const prompt = card.getAttribute('data-prompt');
                    messageInput.value = prompt;
                    sendBtn.disabled = false;
                    messageInput.focus();
                });
            });
            
            // History items
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.history-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    item.classList.add('active');
                });
            });
        }

        // Theme Management
        function setTheme(theme) {
            currentTheme = theme;
            document.body.className = theme;
            localStorage.setItem('theme', theme);
        }
        
        // Start new chat
        function startNewChat() {
            currentChat = [];
            chatMessages.innerHTML = '';
            
            // Re-add welcome message
            const welcomeContainer = document.createElement('div');
            welcomeContainer.className = 'welcome-container';
            welcomeContainer.id = 'welcome-message';
            welcomeContainer.innerHTML = `
                <h1 class="welcome-title">Multi-Modal Healthcare Assistant</h1>
                <p class="welcome-subtitle">Upload medical images, ask questions, and get AI-powered insights for diagnosis and treatment with cutting-edge technology.</p>
                
                <div class="capabilities-grid">
                    <div class="capability-card" data-prompt="Analyze this skin lesion image">
                        <div class="capability-icon">
                            <i class="fas fa-allergies"></i>
                        </div>
                        <div class="capability-title">Skin Lesion Analysis</div>
                        <div class="capability-desc">Upload images for melanoma detection</div>
                    </div>
                    
                    <div class="capability-card" data-prompt="Review this chest X-ray">
                        <div class="capability-icon">
                            <i class="fas fa-lungs"></i>
                        </div>
                        <div class="capability-title">Chest X-ray Review</div>
                        <div class="capability-desc">Identify pneumonia, COVID-19, and other conditions</div>
                    </div>
                    
                    <div class="capability-card" data-prompt="Explain this medication">
                        <div class="capability-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="capability-title">Medication Assistant</div>
                        <div class="capability-desc">Information on drugs, interactions, and side effects</div>
                    </div>
                    
                    <div class="capability-card" data-prompt="Analyze this MRI scan">
                        <div class="capability-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="capability-title">Brain Imaging</div>
                        <div class="capability-desc">Detect tumors, hemorrhages, and other abnormalities</div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(welcomeContainer);
            
            // Re-attach capability card listeners
            const newCapabilityCards = document.querySelectorAll('.capability-card');
            newCapabilityCards.forEach(card => {
                card.addEventListener('click', () => {
                    const prompt = card.getAttribute('data-prompt');
                    messageInput.value = prompt;
                    sendBtn.disabled = false;
                    messageInput.focus();
                });
            });
            
            messageInput.value = '';
            sendBtn.disabled = true;
            
            // Clear active history item
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });
        }
        
        // Handle input change
        function handleInputChange() {
            // Auto-resize textarea
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 200) + 'px';
            
            // Enable/disable send button
            sendBtn.disabled = messageInput.value.trim() === '';
        }
        
        // Handle Enter key
        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!sendBtn.disabled) {
                    sendMessage();
                }
            }
        }
        
        // Send message
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage('user', 'You', message);

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            sendBtn.disabled = true;

            // Hide welcome message
            const welcomeEl = document.getElementById('welcome-message');
            if (welcomeEl) {
                welcomeEl.style.display = 'none';
            }

            // Show loading
            addLoadingMessage();

            // Send to backend
            fetch('https://multi-model-healthcare-system-e5afc0eaeue8bddm.centralindia-01.azurewebsites.net/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ query: message, conversation_history: currentChat })
            })
            .then(response => response.json())
            .then(data => {
                removeLoadingMessage();
                const aiResponse = data.response;
                addMessage('ai', 'Healthcare Assistant', aiResponse);
                currentChat.push({ sender: 'ai', name: 'Healthcare Assistant', text: aiResponse });
            })
            .catch(error => {
                console.error('Error sending message:', error);
                removeLoadingMessage();
                addMessage('ai', 'Healthcare Assistant', 'Sorry, there was an error processing your request. Please try again later.');
            });
        }
        
        // Add message to chat
        function addMessage(sender, name, text) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = sender === 'user' ? 'U' : 'H';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const username = document.createElement('div');
            username.className = 'username';
            username.textContent = name;
            
            const messageText = document.createElement('div');
            messageText.className = 'message-text';
            messageText.textContent = text;
            
            const actions = document.createElement('div');
            actions.className = 'message-actions';
            
            if (sender === 'ai') {
                actions.innerHTML = `
                    <span class="action-icon" onclick="copyToClipboard('${text.replace(/'/g, "\\'")}')">
                        <i class="fas fa-copy"></i>
                    </span>
                    <span class="action-icon"><i class="fas fa-thumbs-up"></i></span>
                    <span class="action-icon"><i class="fas fa-thumbs-down"></i></span>
                `;
            }
            
            content.appendChild(username);
            content.appendChild(messageText);
            content.appendChild(actions);
            
            messageEl.appendChild(avatar);
            messageEl.appendChild(content);
            
            chatMessages.appendChild(messageEl);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            currentChat.push({ sender, name, text });
        }

        // Add loading message
        function addLoadingMessage() {
            const messageEl = document.createElement('div');
            messageEl.className = 'message ai loading-message';
            messageEl.innerHTML = `
                <div class="avatar">
                    <div class="loading"></div>
                </div>
                <div class="message-content">
                    <div class="username">Healthcare Assistant</div>
                    <div class="message-text">Analyzing your request...</div>
                </div>
            `;
            chatMessages.appendChild(messageEl);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Remove loading message
        function removeLoadingMessage() {
            const loadingMessage = document.querySelector('.loading-message');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }
        
        // Handle image upload
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            addMessage('user', 'You', 'Uploaded image: ' + file.name);
            
            const welcomeEl = document.getElementById('welcome-message');
            if (welcomeEl) {
                welcomeEl.style.display = 'none';
            }

            addLoadingMessage();

            const formData = new FormData();
            formData.append('image', file);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                removeLoadingMessage();
                const aiResponse = data.response;
                addMessage('ai', 'Healthcare Assistant', aiResponse);

                if (data.result_image) {
                    const lastMessage = chatMessages.lastChild;
                    const messageText = lastMessage.querySelector('.message-text');

                    const imgPreview = document.createElement('div');
                    imgPreview.style.marginTop = '1rem';
                    imgPreview.style.padding = '0.5rem';
                    imgPreview.style.background = 'var(--bg-glass)';
                    imgPreview.style.borderRadius = '0.5rem';
                    imgPreview.style.backdropFilter = 'blur(10px)';

                    const img = document.createElement('img');
                    img.src = data.result_image;
                    img.alt = 'Analysis result';
                    img.style.width = '100%';
                    img.style.borderRadius = '0.5rem';

                    imgPreview.appendChild(img);
                    messageText.appendChild(imgPreview);
                }
            })
            .catch(error => {
                console.error('Error uploading image:', error);
                removeLoadingMessage();
                addMessage('ai', 'Healthcare Assistant', 'Sorry, there was an error processing your image. Please try again later.');
            });
        }
        
        // Toggle voice input
        function toggleVoiceInput() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('Your browser does not support audio recording.');
                return;
            }

            if (isRecording) {
                // Stop recording
                isRecording = false;
                voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                voiceBtn.style.background = '';
                return;
            }

            // Start recording
            isRecording = true;
            voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
            voiceBtn.style.background = 'var(--accent)';

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const mediaRecorder = new MediaRecorder(stream);
                    const audioChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const formData = new FormData();
                        formData.append('audio', audioBlob, 'recording.wav');

                        fetch('/transcribe', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.transcript) {
                                messageInput.value = data.transcript;
                                sendBtn.disabled = false;
                            }
                        })
                        .catch(error => {
                            console.error('Error transcribing audio:', error);
                        });

                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();

                    // Auto-stop after 30 seconds
                    setTimeout(() => {
                        if (isRecording) {
                            mediaRecorder.stop();
                            isRecording = false;
                            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                            voiceBtn.style.background = '';
                        }
                    }, 30000);
                })
                .catch(error => {
                    console.error('Error accessing microphone:', error);
                    alert('Failed to access microphone. Please check your permissions.');
                    isRecording = false;
                    voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    voiceBtn.style.background = '';
                });
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show feedback
                const notification = document.createElement('div');
                notification.textContent = 'Copied to clipboard!';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--gradient);
                    color: white;
                    padding: 0.75rem 1rem;
                    border-radius: 0.5rem;
                    z-index: 1000;
                    animation: slideIn 0.3s ease-out;
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 2000);
            });
        }
        
        // Load chat history
        function loadChatHistory() {
            console.log("Loading chat history...");
        }
        
        // Initialize app
        init();
    </script>
</body>
</html>